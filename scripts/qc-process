#!/bin/bash

# Noca Processor CLI
# Usage: ./scripts/qc-process [date] [--push]
# Example: ./scripts/qc-process 2024-01-15 --push

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="$(dirname "$SCRIPT_DIR")"

# Set PATH for launchd compatibility (claude CLI needs node in PATH)
export PATH="/opt/homebrew/bin:$PATH"

# Load .env for CLAUDE_PATH (only simple key=value lines)
if [ -f "$PROJECT_DIR/.env" ]; then
    while IFS='=' read -r key value; do
        if [[ ! "$key" =~ ^# ]] && [[ -n "$key" ]]; then
            export "$key=$value"
        fi
    done < "$PROJECT_DIR/.env"
fi

# Run the compiled TypeScript
node "$PROJECT_DIR/dist/processor/cli.js" "$@"
